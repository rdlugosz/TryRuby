!function(Opal){Opal.dynamic_require_severity="warning";var $a,$b,TMP_14,self=Opal.top,$scope=Opal,nil=Opal.nil,$breaker=Opal.breaker,$slice=Opal.slice,$klass=Opal.klass,$hash2=Opal.hash2,$range=Opal.range,$gvars=Opal.gvars;return Opal.add_stubs(["$attr_reader","$attr_accessor","$[]","$to_i","$decode_uri","$!","$empty?","$new","$to_n","$find","$on","$do_run","$match","$html","$value=","$strip","$do_copy","$do_next","$do_back","$do_clear","$do_show_lang","$do_change_lang","$get_content_from_server","$get_language","$get_cookie","$downcase","$===","$set_cookie","$get","$==","$status_code","$each","$[]=","$json","$update_load_prev","$create_index","$switch_to_last_used","$puts","$load_code","$load_code=","$+","$chapter","$title","$html=","$do_goto","$update_screen","$get_step_content","$>","$<=","$<","$has_key?","$update_current_edit","$value","$>=","$focus","$compile","$log_error","$eval_code","$-","$toggle_class","$gsub","$text","$answer","$saved_editor","$saved_output","$get_code_fragment","$to_s","$step","$length","$print_to_output","$last","$chomp","$ok","$mark_ok","$count_lines","$error","$mark_error","$count","$scan","$<<","$join","$ready?","$instance"]),Opal.cdecl($scope,"INITIAL_TRY_CODE","3.times do\n  print 'Welcome '\nend\n"),function(e,$super){function t(){}var n=t=$klass(e,$super,"TryRubyItem",t),r=n.$$proto,i=n.$$scope;return n.$attr_reader("lang","step","title","chapter","answer","ok","error","text","saved_editor","saved_output"),n.$attr_accessor("load_code"),r.$initialize=function(e,t){var n,r,o=this,a=nil,s=nil;return o.lang=t["$[]"]("lang"),o.step=e.$to_i(),o.title=t["$[]"]("title"),o.chapter=t["$[]"]("chapter"),a=o.$decode_uri(t["$[]"]("answer")),o.answer=function(){return(n=(r=a!==!1&&a!==nil)?a["$empty?"]()["$!"]():r)===nil||n.$$is_boolean&&1!=n?nil:i.get("Regexp").$new(a,"mi")}(),o.ok=o.$decode_uri(t["$[]"]("ok")),o.error=o.$decode_uri(t["$[]"]("error")),o.text=o.$decode_uri(t["$[]"]("text")),s=t["$[]"]("load_code"),o.load_code=function(){return(n=(r=s!==!1&&s!==nil)?s["$empty?"]()["$!"]():r)===nil||n.$$is_boolean&&1!=n?nil:o.$decode_uri(s)}(),o.saved_editor="",o.saved_output=""},r.$decode_uri=function(e){var t=nil;return t=decodeURIComponent(e)},r.$update_current_edit=function(e,t){var n=this;return n.saved_editor=e,n.saved_output=t},nil&&"update_current_edit"}(self,null),function(e,$super){function t(){}var n=t=$klass(e,$super,"Editor",t),r=n.$$proto;n.$$scope;return r["native"]=nil,r.$initialize=function(e,t){var n=this;return n["native"]=CodeMirror(document.getElementById(e),t.$to_n())},r["$value="]=function(e){var t=this;return t["native"].setValue(e)},r.$value=function(){var e=this;return e["native"].getValue()},r.$focus=function(){var e=this;return e["native"].focus()},r.$mark_ok=function(e){var t=this;return t["native"].markText({line:e,ch:0},{line:e,ch:99},{className:"tryruby-output-green"})},r.$mark_error=function(e){var t=this;return t["native"].markText({line:e,ch:0},{line:e,ch:99},{className:"tryruby-output-red"})},nil&&"mark_error"}(self,null),function($base,$super){function $TryRuby(){}var self=$TryRuby=$klass($base,$super,"TryRuby",$TryRuby),def=self.$$proto,$scope=self.$$scope;return def.editor=def.items=def.loaded=def.step=def.current_item=def.updating=def.output=def.current_copycode=def.output_buffer=nil,Opal.defs(self,"$instance",function(){var e,t=this;return null==t.instance&&(t.instance=nil),(e=t.instance)!==!1&&e!==nil?e:t.instance=t.$new()}),def.$initialize=function(){var e,t,n,r,i,o,a,s,$,l,u,c,p,d,f,h=this;return h.loaded=!1,h.items=nil,h.step=1,h.output_buffer=[],h.current_item=nil,h.current_copycode=nil,h.updating=!1,(e=$scope.get("Element").$find("#tryruby-title")["$empty?"]())===nil||e.$$is_boolean&&1!=e?(h.output=$scope.get("Editor").$new("output",$hash2(["lineNumbers","mode","readOnly","styleSelectedText"],{lineNumbers:!1,mode:"text",readOnly:!0,styleSelectedText:!0})),h.editor=$scope.get("Editor").$new("editor",$hash2(["lineNumbers","mode","tabMode","theme"],{lineNumbers:!1,mode:"ruby",tabMode:"shift",theme:"tomorrow-night-eighties"})),(e=(t=$scope.get("Element").$find("#btn_run")).$on,e.$$p=(n=function(){var e=n.$$s||this;return e.$do_run()},n.$$s=h,n),e).call(t,"click"),(e=$scope.get("Element").$find("#tryruby-title").$html().$match(/playground/i))===nil||e.$$is_boolean&&1!=e?((e=(r=$scope.get("Element").$find("#btn_copy")).$on,e.$$p=(i=function(){var e=i.$$s||this;return e.$do_copy()},i.$$s=h,i),e).call(r,"click"),(e=(o=$scope.get("Element").$find("#btn_next")).$on,e.$$p=(a=function(){var e=a.$$s||this;return e.$do_next()},a.$$s=h,a),e).call(o,"click"),(e=(s=$scope.get("Element").$find("#btn_back")).$on,e.$$p=($=function(){var e=$.$$s||this;return e.$do_back()},$.$$s=h,$),e).call(s,"click"),(e=(l=$scope.get("Element").$find("#btn_clear")).$on,e.$$p=(u=function(){var e=u.$$s||this;return e.$do_clear()},u.$$s=h,u),e).call(l,"click"),(e=(c=$scope.get("Element").$find("#tryruby-lang-toggle")).$on,e.$$p=(p=function(){var e=p.$$s||this;return e.$do_show_lang()},p.$$s=h,p),e).call(c,"click"),(e=(d=$scope.get("Element").$find("#tryruby-lang-select")).$on,e.$$p=(f=function(){var e=f.$$s||this;return e.$do_change_lang()},f.$$s=h,f),e).call(d,"change"),h.$get_content_from_server(h.$get_language())):(e=[$scope.get("INITIAL_TRY_CODE").$strip()],r=h.editor,r["$value="].apply(r,e),e[e.length-1],nil)):nil},def.$get_language=function(){var e,t,n=this,r=nil,i=nil,o=nil;return r=n.$get_cookie("tryruby_nl_language"),(e=r["$empty?"]())===nil||e.$$is_boolean&&1!=e||(i=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage||navigator.browserLanguage,o=i.$downcase(),r="nl"["$==="](o)?"nl":"es"["$==="](o)?"es":"pt-br"["$==="](o)||"pt"["$==="](o)?"pt-br":"en",n.$set_cookie("tryruby_nl_language",r)),e=[r],t=$scope.get("Element").$find("#tryruby-lang-select"),t["$value="].apply(t,e),e[e.length-1],r},def.$get_content_from_server=function(e){var t,n,r,i=this;return(t=(n=$scope.get("HTTP")).$get,t.$$p=(r=function(e){var t,n,i,o=r.$$s||this;return null==e&&(e=nil),e.$status_code()["$=="](200)?(o.items=$hash2([],{}),(t=(n=e.$json()).$each,t.$$p=(i=function(e,t){var n=i.$$s||this;return null==n.items&&(n.items=nil),null==e&&(e=nil),null==t&&(t=nil),n.items["$[]="](e.$to_i(),$scope.get("TryRubyItem").$new(e,t))},i.$$s=o,i),t).call(n),o.loaded=!0,o.$update_load_prev(),o.$create_index(),o.$switch_to_last_used()):o.$puts("\nWhoops ! Loading the tutorial failed (status = "+e.$status_code()+").\nPlease reload the page.")},r.$$s=i,r),t).call(n,"/try_ruby_"+e+".json")},def.$update_load_prev=function(){var e,t,n,r=this,i=nil;return i="",(e=(t=r.items).$each,e.$$p=(n=function(e,t){var r,o,a;n.$$s||this;return null==e&&(e=nil),null==t&&(t=nil),a=t.$load_code(),o=a!==!1&&a!==nil?t.$load_code()["$empty?"]()["$!"]():a,(r=o!==!1&&o!==nil?t.$load_code()["$[]"]($range(0,3,!1))["$=="]("prev"):o)===nil||r.$$is_boolean&&1!=r||(r=[i["$+"](t.$load_code()["$[]"]($range(4,999999,!1)))],o=t,o["$load_code="].apply(o,r),r[r.length-1]),i=t.$load_code()},n.$$s=r,n),e).call(t)},def.$create_index=function(){var e,t,n,r,i,o=this,a=nil;return a="",(e=(t=o.items).$each,e.$$p=(n=function(e,t){n.$$s||this;return null==e&&(e=nil),null==t&&(t=nil),a=a["$+"]('<option value="'+e+'">'+function(){return t.$chapter()["$=="]("Y")?"":"&nbsp;&nbsp;&nbsp;"}()+t.$title()+"</option>\n")},n.$$s=o,n),e).call(t),e=[a],r=$scope.get("Element").$find("#tryruby-index"),r["$html="].apply(r,e),e[e.length-1],(e=(r=$scope.get("Element").$find("#tryruby-index")).$on,e.$$p=(i=function(){var e=i.$$s||this;return e.$do_goto()},i.$$s=o,i),e).call(r,"change")},def.$get_cookie=function(e){var t,n,r=nil,i=nil;return r=document.cookie,(t=(n=r["$!"]())!==!1&&n!==nil?n:r["$empty?"]())===nil||t.$$is_boolean&&1!=t?(i=r.$match($scope.get("Regexp").$new(""+e+"=(.*?)($|;|,(?! ))")),i!==!1&&i!==nil?i["$[]"](1).$strip():""):""},def.$set_cookie=function(e,t){return document.cookie=e+"="+t},def.$switch_to_last_used=function(){var e,t,n=this,r=nil;return r=n.$get_cookie("tryruby_nl_step").$to_i(),n.$update_screen(n.$get_step_content(function(){return r["$>"](0)?r:1}(),"","")),r["$<="](1)?(e=[$scope.get("INITIAL_TRY_CODE").$strip()],t=n.editor,t["$value="].apply(t,e),e[e.length-1],n.$do_run()):nil},def.$get_step_content=function(e,t,n){var r,i,o,a=this;return(r=(i=(o=a.loaded["$!"]())!==!1&&o!==nil?o:e["$<"](1))!==!1&&i!==nil?i:a.items["$has_key?"](e)["$!"]())===nil||r.$$is_boolean&&1!=r?(a.step["$>"](0)&&a.items["$[]"](a.step).$update_current_edit(t,n),a.step=e,a.current_item=a.items["$[]"](e),a.current_item):nil},def.$do_goto=function(){var e,t=this,n=nil;return(e=t.updating)===nil||e.$$is_boolean&&1!=e?(n=$scope.get("Element").$find("#tryruby-index").$value().$to_i(),n["$>="](0)?t.$update_screen(t.$get_step_content(n,t.editor.$value(),t.output.$value())):nil):nil},def.$do_run=function(){var e,t,n,r=this,i=nil,o=nil,a=nil;if(r.output_buffer=[],e=[""],t=r.output,t["$value="].apply(t,e),e[e.length-1],r.editor.$focus(),i=r.editor.$value().$strip(),(e=i["$empty?"]())!==nil&&(!e.$$is_boolean||1==e))return nil;n=r.loaded,t=n!==!1&&n!==nil?r.current_item:n,(e=t!==!1&&t!==nil?r.current_item.$load_code():t)===nil||e.$$is_boolean&&1!=e||(i=""+r.current_item.$load_code()+"\n"+i);try{o=$scope.get("Opal").$compile(i,$hash2(["source_map_enabled"],{source_map_enabled:!1}))}catch(s){a=s,r.$log_error(a)}return r.$eval_code(o)},def.$do_copy=function(){var e,t,n=this;return e=[n.current_copycode],t=n.editor,t["$value="].apply(t,e),e[e.length-1],n.editor.$focus()},def.$do_next=function(){var e=this;return e.$update_screen(e.$get_step_content(e.step["$+"](1),e.editor.$value(),e.output.$value()))},def.$do_back=function(){var e=this;return e.$update_screen(e.$get_step_content(e.step["$-"](1),e.editor.$value(),e.output.$value()))},def.$do_clear=function(){var e,t,n=this;return e=[""],t=n.editor,t["$value="].apply(t,e),e[e.length-1],n.editor.$focus()},def.$do_show_lang=function(){return $scope.get("Element").$find("#tryruby-lang-hider").$toggle_class("hidden")},def.$do_change_lang=function(){var e=this,t=nil;return t=$scope.get("Element").$find("#tryruby-lang-select").$value(),e.$set_cookie("tryruby_nl_language",t),e.$get_content_from_server(t)},def.$get_code_fragment=function(e){var t=nil;return t=$scope.get("Element").$find("#tryruby-content code").$html().$strip(),t.$gsub("&lt;","<").$gsub("&gt;",">").$gsub("&amp;","&")},def.$update_screen=function(e){var t,n,r=this,i=nil;return(t=e["$!"]())===nil||t.$$is_boolean&&1!=t?(r.updating=!0,t=[e.$title()],n=$scope.get("Element").$find("#tryruby-title"),n["$html="].apply(n,t),t[t.length-1],t=[e.$text()],n=$scope.get("Element").$find("#tryruby-content"),n["$html="].apply(n,t),t[t.length-1],t=[e.$answer()],n=$scope.get("Element").$find("#tryruby-answer"),n["$html="].apply(n,t),t[t.length-1],t=[e.$saved_editor()],n=r.editor,n["$value="].apply(n,t),t[t.length-1],t=[e.$saved_output()],n=r.output,n["$value="].apply(n,t),t[t.length-1],r.current_copycode=r.$get_code_fragment(e.$text()),i=e.$step().$to_s(),t=[i],n=$scope.get("Element").$find("#tryruby-index"),n["$value="].apply(n,t),t[t.length-1],r.$set_cookie("tryruby_nl_step",i),r.editor.$focus(),r.updating=!1):nil},def.$eval_code=function(js_code){var $a,$b,self=this,retval=nil,err=nil,value_to_check=nil;retval=nil;try{retval=eval(js_code),retval=function(){return retval!==!1&&retval!==nil?retval.$to_s():""}(),($a=($b=self.output_buffer.$length()["$=="](0))?retval["$empty?"]()["$!"]():$b)===nil||$a.$$is_boolean&&1!=$a||self.$print_to_output(retval)}catch($err){err=$err,retval=""+err,self.$print_to_output(retval)}return($a=($b=self.current_item["$!"]())!==!1&&$b!==nil?$b:self.current_item.$answer()["$!"]())===nil||$a.$$is_boolean&&1!=$a?(value_to_check=function(){return($a=($b=self.output_buffer.$length()["$>"](0))?self.output_buffer.$last()["$empty?"]()["$!"]():$b)===nil||$a.$$is_boolean&&1!=$a?"":self.output_buffer.$last().$chomp()}(),$b=value_to_check["$empty?"]()["$!"](),($a=$b!==!1&&$b!==nil?value_to_check.$chomp().$match(self.current_item.$answer()):$b)===nil||$a.$$is_boolean&&1!=$a?(self.$print_to_output("\n"+self.current_item.$error()),self.output.$mark_error(self.$count_lines())):(self.$print_to_output("\n"+self.current_item.$ok()),self.output.$mark_ok(self.$count_lines()))):nil},def.$count_lines=function(){var e,t,n,r=this,i=nil;return i=0,(e=(t=r.output_buffer).$each,e.$$p=(n=function(e){n.$$s||this;return null==e&&(e=nil),i=i["$+"](e.$scan(/\n/).$count())},n.$$s=r,n),e).call(t),i["$-"](1)},def.$log_error=function(e){var t=this;return t.$print_to_output(""+e+"\n\n"+e.stack)},def.$print_to_output=function(e,t){var n,r,i=this;return null==t&&(t="\n"),i.output_buffer["$<<"](e.$to_s()["$+"](t)),n=[i.output_buffer.$join()],r=i.output,r["$value="].apply(r,n),n[n.length-1]},nil&&"print_to_output"}(self,null),($a=($b=$scope.get("Document"))["$ready?"],$a.$$p=(TMP_14=function(){TMP_14.$$s||this;return null==$gvars.stdout&&($gvars.stdout=nil),Opal.defs($gvars.stdout,"$puts",function(e){var t,n,r,i=this;return e=$slice.call(arguments,0),(t=(n=e).$each,t.$$p=(r=function(e){r.$$s||this;return null==e&&(e=nil),$scope.get("TryRuby").$instance().$print_to_output(e)},r.$$s=i,r),t).call(n),e.$last()}),Opal.defs($gvars.stdout,"$print",function(e){var t,n,r,i=this;return e=$slice.call(arguments,0),(t=(n=e).$each,t.$$p=(r=function(e){r.$$s||this;return null==e&&(e=nil),$scope.get("TryRuby").$instance().$print_to_output(e,"")},r.$$s=i,r),t).call(n),e.$last()}),$scope.get("TryRuby").$instance()},TMP_14.$$s=self,TMP_14),$a).call($b)}(Opal);